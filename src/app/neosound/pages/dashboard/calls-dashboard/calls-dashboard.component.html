<div *ngIf="!loading; else loadingTemplate">
  <div class="row">
    <div class="col-3 mb-3">
      <div class="card dasboard-card" [ngStyle]="{'background': getColor(0)}">
        <div class="card-body">
          <div class="d-flex align-items-center flex-row m-t-30">
            <div>
              <i class="fa fa-phone-volume fa-3x" style="margin-right: 10px;"></i>
            </div>
            <div class="ml-auto">
              <h4>{{allCallsCount}}</h4>
              <h6>{{t('Calls processed')}}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-3 mb-3">
      <div class="card dasboard-card" [ngStyle]="{'background': getColor(1)}">
        <div class="card-body">
          <div class="d-flex align-items-center flex-row m-t-30">
            <div>
              <i class="fa fa-clock fa-3x" style="margin-right: 10px;"></i>
            </div>
            <div class="ml-auto">
              <h4>{{totalMinutes}}</h4>
              <h6 style="font-size: 0.9rem;">{{t('Call duration, minutes')}}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-3 mb-3">
      <div class="card dasboard-card" [ngStyle]="{'background': getColor(2)}">
        <div class="card-body">
          <div class="d-flex align-items-center flex-row m-t-30">
            <div><i class="fa fa-users fa-3x" style="margin-right: 10px;"></i></div>
            <div class="ml-auto">
              <h4>{{batchesUploaded}}</h4>
              <h6>{{t('Batches uploaded')}}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-3 mb-3">
      <div class="card dasboard-card" [ngStyle]="{'background': getColor(3)}">
        <div class="card-body">
          <div class="d-flex align-items-center flex-row m-t-30">
            <div><i class="fa fa-cloud fa-3x" style="margin-right: 10px;"></i></div>
            <div class="ml-auto">
              <h4>{{apiCallsCount}}</h4>
              <h6>{{t('API calls done')}}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-4 mb-3">
      <div class="card h-100">
        <div class="card-header">{{t('Processed calls')}}</div>
        <div class="card-body" *ngIf="totals">
          <div class="title">{{t('Calls')}}</div>
          <div class="value">{{ totals.allcallscount }}</div>
          <nb-progress-bar [value]="100"></nb-progress-bar>
          <div class="description">{{t('Total number of calls')}}</div>
          <div class="title mt-4">{{t('Emotional calls')}}</div>
          <div class="value">{{ totals.angercallscount }}</div>
          <nb-progress-bar [value]="(totals.angercallscount / totals.allcallscount) * 100"></nb-progress-bar>
          <div class="description">{{t('Number of calls with the emotion level above a threshold')}}</div>
          <div class="title mt-4">{{t('Silent calls')}}</div>
          <div class="value">{{ totals.silentcallscount }}</div>
          <nb-progress-bar [value]="(totals.silentcallscount / totals.allcallscount) * 100"></nb-progress-bar>
          <div class="description">{{t('Number of calls with the average pause longer than a threshold')}}</div>
        </div>
      </div>
    </div>
    <div class="col-4 mb-3">
      <div class="card  card-block d-flex h-100">
        <div class="card-header">{{t('Performance by agent, by calls')}}</div>
        <div class="card-body">
          <div echarts [options]="options2"></div>
        </div>
      </div>
    </div>
    <div class="col-4 mb-3">
      <div class="card card-block d-flex h-100">
        <div class="card-header">{{t('Performance by agent, by %')}}</div>
        <div class="card-body">
          <div echarts [options]="options"></div>
        </div>
      </div>
    </div>
    <div class="col-6 mb-3">
      <div class="card card-block d-flex h-100">
        <div class="card-header">{{t('Stopwords')}}</div>
        <div class="card-body align-items-center d-flex justify-content-center" *ngIf="keywords">
          <angular-tag-cloud [data]="keywords" width="300" height="300" [zoomOnHover]="zoomOPtions" [overflow]="false"
            (clicked)="keywordClicked($event)">
          </angular-tag-cloud>
        </div>
      </div>
    </div>
    <div class="col-6 mb-3" *ngIf="keyWordChart">
      <div class="card" style="min-height: calc(100% - 15px);">
        <div class="card-header">{{t('Hits vs. Stopwords')}}</div>
        <div class="card-body pl-0 pr-0">
          <div echarts [options]="keyWordChart"></div>
        </div>
      </div>
    </div>
    <div class="col-6 mb-3">
      <ngx-total-minutes-plus-batches-chart-bar [fileStatData]="fileStat" [minutesStatData]="minutesStat"
        [apiStatData]="apiStat" [colorsData]="colors">
      </ngx-total-minutes-plus-batches-chart-bar>
    </div>
    <div class="d-none mb-3" [ngClass]="{'col-6 d-block': barChart}" *ngIf="barChart">
      <div class="card" style="min-height: calc(100% - 15px);">
        <div class="card-header">{{t('Number of calls by top 6 batches')}}</div>
        <div class="card-body pl-0 pr-0">
          <div echarts [options]="barChart"></div>
        </div>
      </div>
    </div>
    <div class="col-6 mb-3">
      <ngx-total-minutes-by-day-chart-line [fileStatData]="fileStat" [minutesStatData]="minutesStat"
        [apiStatData]="apiStat" [colorsData]="colors">
      </ngx-total-minutes-by-day-chart-line>
    </div>
    <div class="col-6 mb-3">
      <ngx-calls-by-day-chart-line [fileStatData]="fileStat" [minutesStatData]="minutesStat" [apiStatData]="apiStat"
        [colorsData]="colors">
      </ngx-calls-by-day-chart-line>
    </div>
    <div class="col-6 mb-3" *ngIf="keywords2.length > 0">
      <div class="card  card-block d-flex h-100">
        <div class="card-header">{{t('Most frequently used words')}}</div>
        <div class="card-body align-items-center d-flex justify-content-center" *ngIf="keywords2">
          <angular-tag-cloud [data]="keywords2" width="500" height="300" [zoomOnHover]="zoomOPtions" [overflow]="false">
          </angular-tag-cloud>
        </div>
      </div>
    </div>

    <div class="col-6 mb-3" *ngIf="showHitsVsStopwors">
      <div class="card" style="min-height: calc(100% - 15px);">
        <div class="card-header">{{t('Hits vs. Word')}}</div>
        <div class="card-body pl-0 pr-0">
          <ul class="list-group list-group-flush" style="height: 300px; overflow-y: auto">
            <li class="list-group-item d-flex" *ngFor="let freqWord of freqWords" style="color: #211b19">
              <span>{{freqWord.name}}</span>
              <span class="ml-auto">{{freqWord.value}}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="col-12 mb-3" *ngIf="showRadialTreeData">
      <ngx-keywords-radial-tree [treeRadialData]="radialTreeData" [colors]="colors">
      </ngx-keywords-radial-tree>
    </div>

    <div class="col-6 mb-3">
      <div class="card h-100">
        <div class="card-header">{{t('Welcome on board')}}</div>
        <div class="card-body">
          <div class="" style="overflow-y: auto; max-height: 400px;">
            <div *ngIf="isEnglish()">
              <h4 class="card-text" style="line-height: 2.0;">{{t('SFTP Upload')}}</h4>
              <ul style="line-height: 2.0;">
                <li>Host: <strong>sftp.neosound.eu, port: 22</strong></li>
                <li>{{t('Username and password - your account credentials.')}}</li>
                <li>
                  {{t("Once connected, please go to folder ‘/files', and create or upload the separate sub-folders inside the folder ‘/files’,  per each agent, e.g. '/files/’.")}}
                </li>
                <li>
                  {{t("The recorded calls should be upload to an agent folder inside the folder ‘/files’, e.g. '/files/agent_name. ")}}
                  <div class="card-text my-3" style="line-height: 2.0;">
                    <h6>{{t('IMPORTANT')}}</h6>
                    {{t("The files uploaded to the root folder ‘/files’ folder will NOT be processed! So, please, make sure that the files are being uploaded inside sub-folder, e.g. '/files/agent_name. This is the only way to build statistics per agents.")}}
                  </div>
                </li>
                <li>{{t('The files will start processing soon after uploading.')}}</li>
                <li>
                  {{t('Once the files are processed they will disappear from the SFTP folder, so nobody can download the files from SFTP.')}}
                </li>
              </ul>
              <h4 class="card-text" style="line-height: 2.0;">{{t('Audio format')}}</h4>
              <p class="card-text" style="line-height: 2.0;">
                {{t('For best results, the audio source should be captured and transmitted using a lossless encoding (FLACor LINEAR16). The accuracy of the speech recognition can be reduced if lossy codecs are used to capture or transmit audio, particularly if background noise is present. Lossy codecs include MULAW, AMR, AMR_WB, OGG_OPUS, and SPEEX_WITH_HEADER_BYTE.')}}
              </p>
            </div>
            <div *ngIf="isRussian()">
              <h4 class="card-text" style="line-height: 2.0;">{{t('SFTP Upload')}}</h4>
              <ul style="line-height: 2.0;">
                <li>Сервер: <strong>sftp.neosound.eu, порт: 22</strong></li>
                <li>Имя пользователя и пароль - учетные данные вашей учетной записи.</li>
                <li>
                  После подключения перейдите в папку "/files" и создайте или загрузите отдельные подпапки внутри папки
                  "/files" для каждого агента, например, "/files/".
                </li>
                <li>
                  Записанные вызовы должны быть загружены в папку агента внутри папки "/files", например,
                  "/files/agent_name".
                  <div class="card-text my-3" style="line-height: 2.0;">
                    <h6>{{t('ВАЖНО')}}</h6>
                    Файлы, загруженные в корневую папку '/files', НЕ будут обрабатываться! Поэтому, пожалуйста,
                    убедитесь, что файлы загружены в подпапку, например, '/files/agent_name'. Это единственный способ
                    получения статистики по агентам.
                  </div>
                </li>
                <li> Обработка файлов начнется вскоре после загрузки.</li>
                <li>
                  После обработки эти файлы исчезнут из папки SFTP, поэтому никто не сможет загрузить их с SFTP
                </li>
              </ul>
              <h4 class="card-text" style="line-height: 2.0;">Аудио формат</h4>
              <p class="card-text" style="line-height: 2.0;">
                Для достижения наилучших результатов аудио должно быть записано с помощью без потерь качества (lossless
                encoding FLACor LINEAR16). Точность распознавания речи может быть снижена, если используются кодеки с
                потерями качества, особенно если присутствуют фоновые шумы. Примеры не подходящих кодеков: MULAW, AMR,
                AMR_WB, OGG_OPUS и SPEEX_WITH_HEADER_BYTE.</p>
            </div>
            <div *ngIf="isSpanish()">
              <!-- <h4 class="card-text" style="line-height: 2.0;">{{t('How to upload files')}}</h4> -->
              <p class="card-text" style="line-height: 2.0;">
                Para subir varios archivos, por favor use cualquier cliente SFTP y las siguientes indicaciones.
              </p>
              <ul style="line-height: 2.0;">
                <li>Host: <strong>{{config.sFtpHost}}</strong></li>
                <li>Use su nombre de usuario y contraseña.</li>
                <li>
                  Una vez conectado, abra los archivos de la carpeta y cree/cargue subcarpetas separadas dentro de la
                  carpeta ‘/files", por ejemplo, "/files/lote_agente_X". Luego suba las grabaciones dentro de la
                  subcarpeta de nueva creación.
                </li>
                <li>
                  Por favor, tenga en cuenta que, de momento, solo se pueden procesar archivos de audio en formato GSM,
                  WAV y MP3. No se podrá procesar cualquier otro formato.
                </li>
                <li>
                  <strong>ATENCIÓN:</strong>
                  los archivos subidos directamente a la carpeta ‘/files" no se procesarán. Asegúrese de que se carguen
                  dentro de otra subcarpeta, por ejemplo, '/files/lote_agente_X'. Se requiere un nombre de lote para un
                  procesamiento exitoso. Así usted podrá filtrarlos en la interfaz de usuario como lotes separados por
                  agentes
                </li>
                <li>Los archivos comenzarán a procesarse poco después de la carga.</li>
                <li>
                  Una vez procesados los archivos, aparecerán en la interfaz de usuario y desaparecer de la carpeta de
                  archivos en SFTP.
                </li>
              </ul>
              <p class="card-text" style="line-height: 2.0;">
                Para subir los archivos uno por uno, por favor haga clic sobre "Cargar" en el menú superior. Tras
                completarse la subida del archivo usted será redirigido a la lista de archivos. Sin embargo, tomará unos
                pocos minutos antes de que el archivo se esté procesando y los datos estén disponibles. El tiempo de
                procesamiento depende de la duración del archivo de audio. Para ver el texto, vaya a los detalles del
                archivo haciendo clic en el archivo nombre, a continuación, vaya a la pestaña "Texto". Para fines de
                demostración, sugerimos utilizar archivos con una duración máxima de 4 minutos con nombres cortos de
                archivos.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-6 mb-3">
      <ngx-total-by-queries-chart-pie [fileStatData]="fileStat" [minutesStatData]="minutesStat" [apiStatData]="apiStat"
        [colorsData]="colors">
      </ngx-total-by-queries-chart-pie>
    </div>

    <div class="col-6 mb-3" *ngIf="sankey6">
      <div class="card  card-block d-flex h-100">
        <div class="card-header">{{t('Popular Words Sentiment')}}</div>
        <div class="card-body">
          <div echarts [options]="sankey6"></div>
        </div>
      </div>
    </div>
    <div class="col-6 mb-3" *ngIf="sankey3">
      <div class="card  card-block d-flex h-100" *ngIf="hasSankey">
        <div class="card-header">{{t('Popular Adjectives')}}</div>
        <div class="card-body">
          <div echarts [options]="sankey3"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #loadingTemplate>
  {{ t("Loading...") }}
</ng-template>