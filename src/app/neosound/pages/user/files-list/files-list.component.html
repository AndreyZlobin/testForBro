<nb-card>
  <nb-card-body>
    <div class="row">
      <div class="col">
        <div class="alert alert-danger" *ngIf="errorMessage">{{t('Error:')}}' {{errorMessage}}</div>
        <div *ngIf="!isLoading; else loading" class="">
          <div class="row min-h-filter">
            <div class="col col-md-2">
              <div class="" id="side-filter">
                <div class="filter-wrap pr-3">
                  <div class="row">
                    <div class="col-12">
                      <div class="mb-2">{{t('Name')}}</div>
                      <input [(ngModel)]="filename" [ngModelOptions]="{standalone: true}" type="text" class=""
                        placeholder="" class="form-control form-control-lg"
                        style="padding: 5px 10px; border: 1px solid #dfe3e9;" />
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Batch Id')}}</div>
                      <input [(ngModel)]="batchid" [ngModelOptions]="{standalone: true}" type="text" step="0.01"
                        class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                        placeholder="">
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Uploaded')}}</div>
                      <div class="input-group">
                        <ng-datepicker *ngIf="dateVisible" [(ngModel)]="datefrom" [options]="datePickerFromOptions"
                          class="form-control-bak form-control-lg-bak form-gr-first" style="padding-right: 0px;">
                        </ng-datepicker>
                        <ng-datepicker *ngIf="dateVisible" [(ngModel)]="dateto" [options]="datePickerToOptions"
                          class="form-control-bak form-control-lg-bak form-gr-last" style=""></ng-datepicker>
                      </div>
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Emotion')}}</div>
                      <div class="input-group">
                        <input [(ngModel)]="angerfrom" [ngModelOptions]="{standalone: true}" type="number" step="0.01"
                          class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                          placeholder="{{t('from')}}">
                        <input [(ngModel)]="angerto" [ngModelOptions]="{standalone: true}" type="number" step="0.01"
                          class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9; "
                          placeholder="{{t('to')}}">
                      </div>
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Avg.Pause')}}</div>
                      <div class="input-group">
                        <input [(ngModel)]="pauseAvgFrom" [ngModelOptions]="{standalone: true}" type="number"
                          step="0.01" class="form-control form-control-lg"
                          style="padding: 5px 10px; border: 1px solid #dfe3e9;" placeholder="{{t('from')}}">
                        <input [(ngModel)]="pauseAvgTo" [ngModelOptions]="{standalone: true}" type="number" step="0.01"
                          class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                          placeholder="{{t('to')}}">
                      </div>
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Tot.Pause, minutes')}}</div>
                      <div class="input-group">
                        <input [(ngModel)]="pauseDurFrom" [ngModelOptions]="{standalone: true}" type="number"
                          step="0.01" class="form-control form-control-lg"
                          style="padding: 5px 10px; border: 1px solid #dfe3e9;" placeholder="{{t('from')}}">
                        <input [(ngModel)]="pauseDurTo" [ngModelOptions]="{standalone: true}" type="number" step="0.01"
                          class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                          placeholder="{{t('to')}}">
                      </div>
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Call Duration, minutes')}}</div>
                      <div class="input-group">
                        <input [(ngModel)]="callfrom" [ngModelOptions]="{standalone: true}" type="number" step="0.01"
                          class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                          placeholder="{{t('from')}}">
                        <input [(ngModel)]="callto" [ngModelOptions]="{standalone: true}" type="number" step="0.01"
                          class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                          placeholder="{{t('to')}}">
                      </div>
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Containing words')}}</div>
                      <!-- <input [(ngModel)]="keywordsContain" [ngModelOptions]="{standalone: true}" type="text" placeholder="{{t('Keywords')}}" class="form-control form-control-lg"  style="padding: 5px 10px; border: 1px solid #dfe3e9;"/> -->
                      <!-- <rl-tag-input [(ngModel)]="keywordsContain" placeholder="{{t('Keywords')}}"></rl-tag-input> -->
                      <tag-input [(ngModel)]="keywordsContain" [editable]="true" theme="minimal"
                        (onAdd)="onItemAdd($event, 'keywordsContain')" placeholder="{{t('Words')}}"
                        secondaryPlaceholder="{{t('Words')}}" [separatorKeys]="[',']" [separatorKeyCodes]="[13]"
                        (onBlur)="onItemAdd($event, 'keywordsContain')"></tag-input>
                    </div>
                    <div class="col-12">
                      <div ngbDropdown class="ghost-dropdown dropdown w-100">
                        <button class="btn btn-secondary btn-sm dropdown-toggle" style="border: 1px solid #dfe3e9;"
                          id="dropdownBasic1" ngbDropdownToggle>{{t(stopwordLooking)}}</button>
                        <ul ngbDropdownMenu aria-labelledby="dropdownBasic1" class="dropdown-menu">
                          <li class="dropdown-item" ngbDropdownItem (click)="setStopwordLooking('Everywhere')">
                            {{t('Everywhere')}}</li>
                          <li class="dropdown-item" ngbDropdownItem (click)="setStopwordLooking('Agent')">{{t('Agent')}}
                          </li>
                          <li class="dropdown-item" ngbDropdownItem (click)="setStopwordLooking('Customer')">
                            {{t('Customer')}}</li>
                        </ul>
                      </div>
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Missing words')}}</div>
                      <tag-input [(ngModel)]="keywordsNotContain" [editable]="true" theme="minimal"
                        (onAdd)="onItemAdd($event, 'keywordsNotContain')" placeholder="{{t('Missing words')}}"
                        secondaryPlaceholder="{{t('Words')}}" [separatorKeys]="[',']" [separatorKeyCodes]="[13]"
                        (onBlur)="onItemAdd($event, 'keywordsNotContain')"></tag-input>
                    </div>
                    <div class="col-12 pt-3">
                      <div class="mb-2">{{t('Tags')}}</div>
                      <tag-input [(ngModel)]="tagsContain" [editable]="true" theme="minimal"
                        (onAdd)="onItemAdd($event, 'tagsContain')" placeholder="{{t('Tags')}}"
                        secondaryPlaceholder="{{t('Tags')}}" [separatorKeys]="[',']" [separatorKeyCodes]="[13]"
                        (onBlur)="onItemAdd($event, 'tagsContain')"></tag-input>
                    </div>
                    <div class="col-12">
                      <div class="mt-3">
                        <label>
                          <input [(ngModel)]="stopOnly" [ngModelOptions]="{standalone: true}" type="checkbox"
                            class="" />
                          {{t('Filter calls with stopwords')}}
                        </label>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="mt-3">
                        <label>
                          <input [(ngModel)]="missingOnly" [ngModelOptions]="{standalone: true}" type="checkbox"
                            class="" />
                          {{t('Filter calls with missing words')}}
                        </label>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="mt-3">
                        <label>
                          <input [(ngModel)]="favoriteOnly" [ngModelOptions]="{standalone: true}" type="checkbox"
                            class="" />
                          {{t('Filter favorite calls')}}
                        </label>
                      </div>
                    </div>
                    <div class="col-12">
                      <button class="btn btn-primary mt-4 w-100" style="cursor: pointer;"
                        (click)="filterIt()">{{t('Apply')}}</button>
                    </div>
                    <div class="col-12">
                      <button class="btn btn-secondary mt-2 w-100" style="cursor: pointer;"
                        (click)="resetFilter()">{{t('Reset')}}</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col col-md-10 pl-4 border-left">
              <div class="row mb-1">
                <div class="col-3">
                  <h1>{{t('Files')}}</h1>
                </div>
                <div class="col-6" *ngIf="!isLoadingSpinner;">
                  <div class="btn-toolbar mb-3 mt-3" *ngIf="!isLoading && files && !!files.length">
                    <div class="btn-group mr-2 mb-2">
                      <div
                        *ngFor="let pageItem of getPages() | paginate: { itemsPerPage: paginationNum, currentPage: (page+1), totalItems: totalCount }">
                      </div>
                      <pagination-controls (pageChange)="getPage($event - 1)" previousLabel="{{t('previous')}}"
                        nextLabel="{{t('next')}}"></pagination-controls>
                    </div>
                  </div>
                </div>
                <div class="col-3" *ngIf="!isLoadingSpinner;">
                  <div class="row mb-1">
                    <!-- <div class="col-2 pr-0" style="line-height: 31px;">Filename:</div> -->
                    <div class="col text-right pl-0" *ngIf="!isLoading">
                      <!-- <button class="btn btn-primary ml-5 pull-right mt-1 btn-sm" (click)="toggleView()">
                        <i *ngIf="viewStyle === 1" class="fa fa-list"></i>
                        <i *ngIf="viewStyle === 0" class="fas fa-table"></i>
                      </button> -->
                      <button class="btn btn-primary ml-5 pull-right mt-1 btn-sm"
                        (click)="exportCSV()">{{t('Export to CSV')}}</button>
                    </div>
                  </div>
                </div>
              </div>
              <ng-container *ngIf="viewStyle === 0">
                <div class="d-flex border-top border-bottom">
                  <span class="mt-2 pt-1">Sort:</span>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('batchId')">
                    {{t('Batch Id')}}
                    <i *ngIf="sortBy === 'batchId' && sort ==='up'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'batchId' && sort ==='down'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'batchId'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('name')">{{t('Name')}}
                    <i *ngIf="sortBy === 'name' && sort ==='up'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'name' && sort ==='down'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'name'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('uploaded')">{{t('Uploaded')}}
                    <i *ngIf="sortBy === 'uploaded' && sort ==='up'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'uploaded' && sort ==='down'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'uploaded'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('duration')">{{t('Duration')}}
                    <i *ngIf="sortBy === 'duration' && sort ==='up'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'duration' && sort ==='down'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'duration'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('avgpause')">{{t('Avg.Pause')}}
                    <i *ngIf="sortBy === 'avgpause' && sort ==='down'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'avgpause' && sort ==='up'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'avgpause'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('pausedur')">{{t('Tot.Pause')}}
                    <i *ngIf="sortBy === 'pausedur' && sort ==='down'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'pausedur' && sort ==='up'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'pausedur'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('stopWords')">{{t('Stopwords')}}
                    <i *ngIf="sortBy === 'stopWords' && sort ==='down'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'stopWords' && sort ==='up'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'stopWords'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('compliance')">{{t('Compliance')}}
                    <i *ngIf="sortBy === 'compliance' && sort ==='down'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'compliance' && sort ==='up'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'compliance'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                  <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
                    (click)="sortTable('emotion')">{{t('Emotion')}}
                    <i *ngIf="sortBy === 'emotion' && sort ==='down'" class="fas fa-sort-up"></i><i
                      *ngIf="sortBy === 'emotion' && sort ==='up'" class="fas fa-sort-down"></i><i
                      *ngIf="sortBy !== 'emotion'" style="color: #bbbbbb" class="fas fa-sort"></i>
                  </button>
                </div>
                <div>
                  <div class="d-flex flex-column w-100">
                    <div class="d-flex flex-row border-top border-bottom align-items-stretch justify-content-start"
                      *ngFor="let item of files; let i = index">
                      <div (click)="markFavorite(item, i)" style="cursor: pointer; width: 4%;"
                        class="align-self-center">
                        <i *ngIf="getBool(item.pin)" class="fa fa-star"></i>
                        <i *ngIf="!getBool(item.pin)" class="far fa-star"></i>
                      </div>
                      <div style="width: 46%">
                        <div class="d-flex flex-column">
                          <div class="w-100 mt-2">
                            <a [routerLink]="getLink(item)" style="cursor: pointer;"
                              class="font-weight-bold text-primary text-truncate">
                              <span style="width: 25rem;">{{item.filename}}</span>
                            </a>
                          </div>
                          <div class="w-100">
                            <div class="row">
                              <div class="col-6 align-self-center">
                                <div class="w-100 my-2">
                                  <a style="text-decoration: underline; cursor: pointer;" (click)="filterByBatch(item.batchid)">{{item.batchid}}</a>
                                </div>
                              </div>
                              <div class="col-3">
                                <div class="row" style="font-size: xx-small;">
                                  <div class="col-6 font-weight-normal">{{t('Uploaded')}}</div>
                                  <div class="col-6 font-weight-bold">{{item.uploaddate | date: 'dd/MM/yyyy'}}</div>
                                  <div class="col-6 font-weight-normal my-1">{{t('Duration')}}</div>
                                  <div class="col-6 font-weight-bold my-1">{{ getDateVal(item.duration) | date:'mm:ss'}}
                                  </div>
                                  <div class="col-6 font-weight-normal">{{t('Silence')}}</div>
                                  <div class="col-6 font-weight-bold" *ngIf="item.pause && item.pause.dur">
                                    <span>{{getDateVal(item.pause.dur) | date: 'mm:ss'}}</span>&nbsp;<span>({{item.pause.dur / item.duration | percent}})</span>
                                  </div>
                                </div>
                              </div>
                              <div class="col-3">
                                <div class="row" style="font-size: xx-small;" *ngIf="item.pause && item.pause.dur">
                                  <div class="col-6 font-weight-normal">{{t('Pauses')}}</div>
                                  <div class="col-6 font-weight-bold">&nbsp;</div>
                                  <div class="col-6 font-weight-normal my-1">{{t('Max.')}}</div>
                                  <div class="col-6 font-weight-bold my-1">
                                    -
                                  </div>
                                  <div class="col-6 font-weight-normal">{{t('Avg.')}}</div>
                                  <div class="col-6 font-weight-bold">{{getDateVal(item.pause.avg) | date: 'mm:ss'}}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="w-100 mb-1">
                            <span class="badge badge-secondary mr-1" *ngFor="let tag of item.tags">{{tag}}</span>
                            <button class="btn p-0 c-normal" style="cursor: pointer;"
                              (click)="showModal(tagModal, item, i)" tooltip="{{t('Edit tags')}}">
                              <i class="fa fa-pencil-alt"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="d-flex flex-row justify-content-between align-self-center" style="width: 15%">
                        <div class="ml-4">
                          <i tooltip="{{t('All')}}" class="fa fa-user-friends mr-2"></i>
                          <span tooltip="{{getStopwords(item)}}" class="badge badge-danger">{{item.stopwordcount ? item.stopwordcount : 0}}</span>
                          </div>
                        <div>
                          <i class="fa fa-headset mr-2" tooltip="{{t('Agent')}}"></i>
                          <span
                            tooltip="{{getAgentStopwords(item)}}"
                            class="badge badge-danger">{{item.agentstopwordcount ? item.agentstopwordcount : 0 }}</span></div>
                        <div class="mr-4">
                          <i tooltip="{{t('Client')}}" class="fa fa-user-tie mr-2"></i>
                          <span
                            tooltip="{{getCustomerStopword(item)}}"
                            class="badge badge-danger">{{item.customerstopwordcount ? item.customerstopwordcount : 0}}</span>
                        </div>
                      </div>
                      <div class="d-flex justify-content-center align-self-scratch font-weight-bold" style="width: 15%">
                        <div class="align-self-center text-center mr-1"><i class="fa fa-3x fa-shield-alt"></i></div>
                        <div class="align-self-center text-center">
                          <div style="font-size: x-small;">{{t('Compliance')}}:</div>
                          <h2 [ngStyle]="{'color': getOpacityLevelCompliance(item.compliancepercent)}">
                            {{item.compliancepercent !== '-' ? abc(item.compliancepercent) + '%' : '-' }}
                          </h2>
                        </div>
                      </div>
                      <div class="d-flex justify-content-center align-self-scratch" style="width: 15%"
                        [ngStyle]="{'background': getOpacityLevelAnger(item.angertop)}">
                        <div class="align-self-center text-center mr-1"><i class="fa fa-3x fa-thermometer-empty"></i>
                        </div>
                        <div class="align-self-center text-center font-weight-bold">
                          <div style="font-size: x-small;">Average emotional level: </div>
                          <h2 *ngIf="item.angertop && item.angertop.anger; else empty">
                            {{item.angertop && item.angertop.anger}}%
                          </h2>
                          <ng-template #empty>
                            <h2>
                              -
                            </h2>
                          </ng-template>
                        </div>
                      </div>
                      <div class="d-flex justify-content-around" style="width: 7%">
                        <button class="btn p-2 c-normal align-self-center" style="cursor: pointer;"
                          (click)="proccessFile(item, i)" tooltip="{{t('Refresh')}}{{proccessing[i] ? '...' : ''}}">
                          <i class="fa fa-sync"></i>
                        </button>
                        <button class="btn p-2 c-normal align-self-center" style="cursor: pointer;"
                          (click)="delete(item.batchid, item.fileid)" tooltip="{{t('Delete')}}">
                          <i class="fa fa-trash-alt"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
              <ng-container *ngIf="viewStyle === 1">
                <table class="table" *ngIf="!isLoadingSpinner; else spinner">
                  <thead>
                    <tr>
                      <th></th>
                      <th class="text-one-line"><a (click)="sortTable('batchId')">{{t('Batch Id')}}
                          <i *ngIf="sortBy === 'batchId' && sort ==='up'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'batchId' && sort ==='down'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'batchId'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th class="text-one-line"><a (click)="sortTable('name')">{{t('Name')}}
                          <i *ngIf="sortBy === 'name' && sort ==='up'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'name' && sort ==='down'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'name'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th class="text-one-line"><a (click)="sortTable('uploaded')">{{t('Uploaded')}}
                          <i *ngIf="sortBy === 'uploaded' && sort ==='up'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'uploaded' && sort ==='down'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'uploaded'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th class="text-one-line"><a (click)="sortTable('duration')">{{t('Duration')}}
                          <i *ngIf="sortBy === 'duration' && sort ==='up'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'duration' && sort ==='down'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'duration'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th class="text-one-line"><a (click)="sortTable('emotion')">{{t('Emotion')}}
                          <i *ngIf="sortBy === 'emotion' && sort ==='down'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'emotion' && sort ==='up'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'emotion'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th class="text-one-line"><a (click)="sortTable('avgpause')">{{t('Avg.Pause')}}
                          <i *ngIf="sortBy === 'avgpause' && sort ==='down'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'avgpause' && sort ==='up'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'avgpause'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th class="text-one-line"><a (click)="sortTable('pausedur')">{{t('Tot.Pause')}}
                          <i *ngIf="sortBy === 'pausedur' && sort ==='down'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'pausedur' && sort ==='up'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'pausedur'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th class="text-one-line"><a (click)="sortTable('stopWords')">{{t('Stopwords')}}
                          <i *ngIf="sortBy === 'stopWords' && sort ==='down'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'stopWords' && sort ==='up'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'stopWords'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th class="text-one-line"><a (click)="sortTable('compliance')">{{t('Compliance')}}
                          <i *ngIf="sortBy === 'compliance' && sort ==='down'" class="fas fa-sort-up"></i><i
                            *ngIf="sortBy === 'compliance' && sort ==='up'" class="fas fa-sort-down"></i><i
                            *ngIf="sortBy !== 'compliance'" style="color: #bbbbbb" class="fas fa-sort"></i></a>
                      </th>
                      <th></th>
                      <th></th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of files; let i = index">
                      <td>
                        <span (click)="markFavorite(item, i)" style="cursor: pointer;">
                          <i *ngIf="getBool(item.pin)" class="fa fa-star"></i>
                          <i *ngIf="!getBool(item.pin)" class="far fa-star"></i>
                        </span>
                      </td>
                      <td>
                        <div class="text-nowrap" tooltip="{{item.batchid}}" style="max-width: 150px;">
                          {{ item.batchid}}
                        </div>
                      </td>
                      <td><a [routerLink]="getLink(item)" style="cursor: pointer;">
                          <div class="text-nowrap" tooltip="{{item.filename}}">{{item.filename}}</div>
                        </a></td>
                      <td>
                        <div class="text-nowrap" tooltip="{{item.uploaddate | date: 'dd/MM/yyyy hh:mm:ss'}}">
                          {{item.uploaddate | date: 'dd/MM/yyyy'}}</div>
                      </td>
                      <td>
                        <div class="text-nowrap">
                          <span tooltip="{{getDateVal(item.duration) | date:'mm:ss.SSS'}}">
                            {{ getDateVal(item.duration) | date:'mm:ss'}}</span>
                          <span *ngIf="item.errm || item.errc" tooltip="{{item.errm.trim() || item.errc}}">
                            <i class="fa fa-exclamation ml-2" style="color: #dc3545"></i>
                          </span>
                        </div>
                      </td>
                      <td [ngStyle]="{'background': getOpacityLevelAnger(item.angertop)}">
                        <div *ngIf="item.angertop && item.angertop.anger">
                          {{item.angertop && item.angertop.anger}}%
                        </div>
                      </td>
                      <td [ngStyle]="{'background': getOpacityLevelPause(item.pauses)}">{{ item.pauses }}</td>
                      <td>
                        <span *ngIf="item.pause && item.pause.dur" style="cursor: pointer"
                          tooltip='{{item.pause.dur / item.duration | percent}}'>
                          {{getDateVal(item.pause.dur) | date: 'mm:ss'}}
                        </span>
                      </td>
                      <td class="text-center">
                        <div class="badge badge-danger" style="cursor: pointer" *ngIf="item.stopwordcount"
                          tooltip="{{getStopwords(item)}}">
                          {{item.stopwordcount}}
                        </div>
                        <span *ngIf="!item.stopwords">-</span>
                      </td>
                      <td class="text-center">
                        <div class="" style="cursor: pointer"
                          [ngStyle]="{'color': getOpacityLevelCompliance(item.compliancepercent)}">
                          {{item.compliancepercent}}
                        </div>
                      </td>
                      <td>
                        <button class="btn p-2 c-normal" style="cursor: pointer;" (click)="proccessFile(item, i)"
                          tooltip="{{t('Refresh')}}{{proccessing[i] ? '...' : ''}}">
                          <i class="fa fa-sync"></i>
                        </button>
                      </td>
                      <td>
                        <button class="btn p-2 c-normal" style="cursor: pointer;"
                          (click)="delete(item.batchid, item.fileid)" tooltip="{{t('Delete')}}">
                          <i class="fa fa-trash-alt"></i>
                        </button>
                      </td>
                      <td>
                        <span (click)="showModal(tagModal, item, i)">
                          <div class="badge badge-secondary m-1" style="cursor: pointer;" *ngFor="let tag of item.tags">
                            {{tag}}
                          </div>
                          <i class="fa fa-pencil-alt ml-2"></i>
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </ng-container>
              <div *ngIf="!isLoadingSpinner">
                <div *ngIf="!isLoading && !files.length" class="mb-4">{{t('0 Files')}}</div>
                <div class="btn-toolbar mb-3 mt-3" *ngIf="!isLoading && files && !!files.length">
                  <div class="btn-group m-auto">
                    <div
                      *ngFor="let pageItem of getPages() | paginate: { itemsPerPage: paginationNum, currentPage: (page+1), totalItems: totalCount }">
                    </div>
                    <pagination-controls (pageChange)="getPage($event - 1)" previousLabel="{{t('previous')}}"
                      nextLabel="{{t('next')}}"></pagination-controls>
                  </div>
                </div>
                <div class="mt-3 mb-2">
                  <h6>{{t('Total files on page')}} {{getFilesOnPageLabel()}} {{t('out of')}} {{totalCount}} </h6>
                </div>
                <button class="btn mt-3 btn-secondary" (click)="refresh()">{{t('Refresh')}}</button>
              </div>
            </div>
          </div>
        </div>
        <ng-template #loading>
          {{t('Loading...')}}
        </ng-template>
      </div>
    </div>
  </nb-card-body>
</nb-card>

<ng-template #tagModal>
  <div class="modal-header">
    {{t('Tags')}}
    <button type="button" class="close pull-right" aria-label="Close" (click)="hideModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body tagsModal">
    <tag-input [(ngModel)]="itemTags" [editable]="true" theme="minimal" (onAdd)="onItemAdd($event, 'itemTags')"
      placeholder="{{t('Add Tag')}}" secondaryPlaceholder="{{t('Add Tag')}}" [separatorKeys]="[',']"
      [separatorKeyCodes]="[13]" (onBlur)="onItemAdd($event, 'itemTags')"></tag-input>
    <div class="text-right">
      <button class="btn btn-primary mr-3" (click)="saveTags()">{{t('Save')}}</button>
      <button class="btn btn-link btn-secondary" (click)="hideModal()">{{t('Close')}}</button>
    </div>
  </div>
</ng-template>

<ng-template #spinner>
  <div class="load-container load1">
    <div class="loader">{{ t("Loading...") }}</div>
  </div>
</ng-template>