<nb-card>
  <nb-card-body>
    <div class="alert alert-danger" *ngIf="errorMessage">{{t('Error:')}}' {{errorMessage}}</div>
    <div class="row">
      <div class="col-2">
        <div class="" id="side-filter">
          <div class="row">
            <div class="col-12">
              <h3 class="mb-2">{{t('Calls')}}</h3>
            </div>
            <div class="col-12">
              <div class="mb-2">{{t('Name')}}</div>
              <input [(ngModel)]="filterService.filter.filename" [ngModelOptions]="{standalone: true}" type="text"
                class="" placeholder="" class="form-control form-control-lg"
                style="padding: 5px 10px; border: 1px solid #dfe3e9;" />
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Batch Id')}}</div>
              <input [(ngModel)]="filterService.filter.batchid" [ngModelOptions]="{standalone: true}" type="text"
                step="0.01" class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                placeholder="">
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Uploaded')}}</div>
              <div class="input-group">
                <input bsDaterangepicker [(ngModel)]="filterService.filter.uploadDate"
                  [ngModelOptions]="{standalone: true}" type="text" class="form-control form-control-lg"
                  style="padding: 5px 10px; border: 1px solid #dfe3e9;" placeholder="">
              </div>
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Emotion')}}</div>
              <div class="input-group">
                <input [(ngModel)]="filterService.filter.angerfrom" [ngModelOptions]="{standalone: true}" type="number"
                  step="0.01" class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                  placeholder="{{t('from')}}">
                <input [(ngModel)]="filterService.filter.angerto" [ngModelOptions]="{standalone: true}" type="number"
                  step="0.01" class="form-control form-control-lg"
                  style="padding: 5px 10px; border: 1px solid #dfe3e9; " placeholder="{{t('to')}}">
              </div>
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Avg.Pause')}}</div>
              <div class="input-group">
                <input [(ngModel)]="filterService.filter.pauseAvgFrom" [ngModelOptions]="{standalone: true}"
                  type="number" step="0.01" class="form-control form-control-lg"
                  style="padding: 5px 10px; border: 1px solid #dfe3e9;" placeholder="{{t('from')}}">
                <input [(ngModel)]="filterService.filter.pauseAvgTo" [ngModelOptions]="{standalone: true}" type="number"
                  step="0.01" class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                  placeholder="{{t('to')}}">
              </div>
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Tot.Pause, minutes')}}</div>
              <div class="input-group">
                <input [(ngModel)]="filterService.filter.pauseDurFrom" [ngModelOptions]="{standalone: true}"
                  type="number" step="0.01" class="form-control form-control-lg"
                  style="padding: 5px 10px; border: 1px solid #dfe3e9;" placeholder="{{t('from')}}">
                <input [(ngModel)]="filterService.filter.pauseDurTo" [ngModelOptions]="{standalone: true}" type="number"
                  step="0.01" class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                  placeholder="{{t('to')}}">
              </div>
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Call Duration, minutes')}}</div>
              <div class="input-group">
                <input [(ngModel)]="filterService.filter.callfrom" [ngModelOptions]="{standalone: true}" type="number"
                  step="0.01" class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                  placeholder="{{t('from')}}">
                <input [(ngModel)]="filterService.filter.callto" [ngModelOptions]="{standalone: true}" type="number"
                  step="0.01" class="form-control form-control-lg" style="padding: 5px 10px; border: 1px solid #dfe3e9;"
                  placeholder="{{t('to')}}">
              </div>
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Containing words')}}</div>
              <tag-input [(ngModel)]="filterService.filter.keywordsContain" [editable]="true" theme="minimal"
                (onAdd)="onItemAdd($event, 'keywordsContain')" placeholder="{{t('Words')}}"
                secondaryPlaceholder="{{t('Words')}}" [separatorKeys]="[',']" [separatorKeyCodes]="[13]"
                (onBlur)="onItemAdd($event, 'keywordsContain')"></tag-input>
            </div>
            <div class="col-12">
              <div ngbDropdown class="ghost-dropdown dropdown w-100">
                <button class="btn btn-secondary btn-sm dropdown-toggle" style="border: 1px solid #dfe3e9;"
                  id="dropdownBasic1" ngbDropdownToggle>{{t(filterService.filter.stopwordLooking)}}</button>
                <ul ngbDropdownMenu aria-labelledby="dropdownBasic1" class="dropdown-menu">
                  <li class="dropdown-item" ngbDropdownItem (click)="setStopwordLooking('Everywhere')">
                    {{t('Everywhere')}}</li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setStopwordLooking('Agent')">{{t('Agent')}}
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setStopwordLooking('Customer')">
                    {{t('Customer')}}</li>
                </ul>
              </div>
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Missing words')}}</div>
              <tag-input [(ngModel)]="filterService.filter.keywordsNotContain" [editable]="true" theme="minimal"
                (onAdd)="onItemAdd($event, 'keywordsNotContain')" placeholder="{{t('Missing words')}}"
                secondaryPlaceholder="{{t('Words')}}" [separatorKeys]="[',']" [separatorKeyCodes]="[13]"
                (onBlur)="onItemAdd($event, 'keywordsNotContain')"></tag-input>
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Tags')}}</div>
              <tag-input [(ngModel)]="filterService.filter.tagsContain" [editable]="true" theme="minimal"
                (onAdd)="onItemAdd($event, 'tagsContain')" placeholder="{{t('Tags')}}"
                secondaryPlaceholder="{{t('Tags')}}" [separatorKeys]="[',']" [separatorKeyCodes]="[13]"
                (onBlur)="onItemAdd($event, 'tagsContain')"></tag-input>
            </div>
            <div class="col-12 pt-3">
              <div class="mb-2">{{t('Topics')}}</div>
              <input type="text" class="form-control" [(ngModel)]="selectedTopic" [typeahead]="topics"
                [typeaheadMinLength]="0" class="form-control form-control-lg" [ngModelOptions]="{standalone: true}"
                (typeaheadOnSelect)="onSelectTopic($event)">
            </div>
            <div class="col-12 pt-3" *ngIf="selectedTopics">
              <ul class="list-group pl-0">
                <li class="list-group-item d-flex justify-content-between align-items-center w-100"
                  *ngFor="let topic of selectedTopics">{{topic}}<button type="button" class="close ml-2"
                    (click)="onRemoveTopic(topic)">
                    <span aria-hidden="true">&times;</span>
                  </button></li>
              </ul>
            </div>
            <div class="col-12">
              <div class="mb-2">{{t('Sentiment trend')}}</div>
              <div ngbDropdown class="ghost-dropdown dropdown w-100">
                <button class="btn btn-secondary btn-sm dropdown-toggle" style="border: 1px solid #dfe3e9;"
                  id="dropdownBasic1"
                  ngbDropdownToggle>{{t(filterService.filter.sentimentTrend ? filterService.filter.sentimentTrend : "Select trend")}}</button>
                <ul ngbDropdownMenu aria-labelledby="dropdownBasic1" class="dropdown-menu">
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend(null)">
                    No trend
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Negative-Negative')">
                    <i class="far fa-angry text-danger"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-angry text-danger"></i>
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Negative-Neutral')">
                    <i class="far fa-angry text-danger"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-meh text-info"></i>
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Negative-Positive')">
                    <i class="far fa-angry text-danger"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-grin text-success"></i>
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Neutral-Negative')">
                    <i class="far fa-meh text-info"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-angry text-danger"></i>
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Neutral-Neutral')">
                    <i class="far fa-meh text-info"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-meh text-info"></i>
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Neutral-Positive')">
                    <i class="far fa-meh text-info"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-grin text-success"></i></li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Positive-Negative')">
                    <i class="far fa-grin text-success"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-angry text-danger"></i>
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Positive-Neutral')">
                    <i class="far fa-grin text-success"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-meh text-info"></i>
                  </li>
                  <li class="dropdown-item" ngbDropdownItem (click)="setEmotionalTrend('Positive-Positive')">
                    <i class="far fa-grin text-success"></i>
                    <i class="fas fa-long-arrow-alt-right mx-2"></i>
                    <i class="far fa-grin text-success"></i>
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-12">
              <div class="mt-3">
                <label>
                  <input [(ngModel)]="filterService.filter.stopOnly" [ngModelOptions]="{standalone: true}"
                    type="checkbox" class="" />
                  {{t('Filter calls with stopwords')}}
                </label>
              </div>
            </div>
            <div class="col-12">
              <div class="mt-3">
                <label>
                  <input [(ngModel)]="filterService.filter.missingOnly" [ngModelOptions]="{standalone: true}"
                    type="checkbox" class="" />
                  {{t('Filter calls with missing words')}}
                </label>
              </div>
            </div>
            <div class="col-12">
              <div class="mt-3">
                <label>
                  <input [(ngModel)]="filterService.filter.favoriteOnly" [ngModelOptions]="{standalone: true}"
                    type="checkbox" class="" />
                  {{t('Filter favorite calls')}}
                </label>
              </div>
            </div>
            <div class="col-12">
              <button class="btn btn-primary mt-4 w-100" style="cursor: pointer;"
                (click)="filterIt()">{{t('Apply')}}</button>
            </div>
            <div class="col-12">
              <button class="btn btn-secondary mt-2 w-100" style="cursor: pointer;"
                (click)="resetFilter()">{{t('Reset')}}</button>
            </div>
          </div>
        </div>
      </div>
      <div class="col col-md-10 border-left">
        <div class="d-flex flex-row justify-content-between align-items-start" *ngIf="!filterService.isLoading">
          <div class="mt-2">{{t('Total files on page')}} {{filterService.label}} {{t('out of')}}
              {{filterService.totalcount}}
          </div>
          <div class="btn-toolbar mt-1">
            <div class="btn-group">
              <div
                *ngFor="let pageItem of filterService.fileStore | paginate: { itemsPerPage: filterService.filter.itemsn, currentPage: filterService.filter.pagen, totalItems: filterService.totalcount }">
              </div>
              <pagination-controls (pageChange)="getPage($event)" previousLabel="{{t('previous')}}"
                nextLabel="{{t('next')}}"></pagination-controls>
            </div>
          </div>
          <div class="mb-1">
            <button class="btn btn-primary btn-sm" (click)="exportCSV()">{{t('Export to CSV')}}</button>
          </div>
        </div>
        <div class="file-list mt-2" *ngIf="!filterService.isLoading; else spinner">
          <div class="d-flex border-top border-bottom sort-bar">
            <span class="mt-2 pt-1">Sort:</span>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb" (click)="sortTable('BatchId')">
              {{t('Batch Id')}}
              <i *ngIf="filterService.filter.sortby === 'BatchId' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-up"></i>
              <i *ngIf="filterService.filter.sortby === 'BatchId' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-down"></i>
              <i *ngIf="filterService.filter.sortby !== 'BatchId'" style="color: #bbbbbb" class="fas fa-sort"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
              (click)="sortTable('Name')">{{t('Name')}}
              <i *ngIf="filterService.filter.sortby === 'Name' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-up"></i><i
                *ngIf="filterService.filter.sortby === 'Name' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-down"></i><i *ngIf="filterService.filter.sortby !== 'Name'" style="color: #bbbbbb"
                class="fas fa-sort"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
              (click)="sortTable('Uploaded')">{{t('Uploaded')}}
              <i *ngIf="filterService.filter.sortby === 'Uploaded' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-up"></i><i
                *ngIf="filterService.filter.sortby === 'Uploaded' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-down"></i><i *ngIf="filterService.filter.sortby !== 'Uploaded'"
                style="color: #bbbbbb" class="fas fa-sort"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
              (click)="sortTable('Duration')">{{t('Duration')}}
              <i *ngIf="filterService.filter.sortby === 'Duration' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-up"></i><i
                *ngIf="filterService.filter.sortby === 'Duration' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-down"></i><i *ngIf="filterService.filter.sortby !== 'Duration'"
                style="color: #bbbbbb" class="fas fa-sort"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
              (click)="sortTable('AvgPause')">{{t('Avg.Pause')}}
              <i *ngIf="filterService.filter.sortby === 'AvgPause' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-up"></i><i
                *ngIf="filterService.filter.sortby === 'AvgPause' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-down"></i><i *ngIf="filterService.filter.sortby !== 'AvgPause'"
                style="color: #bbbbbb" class="fas fa-sort"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
              (click)="sortTable('PauseDur')">{{t('Tot.Pause')}}
              <i *ngIf="filterService.filter.sortby === 'PauseDur' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-up"></i><i
                *ngIf="filterService.filter.sortby === 'PauseDur' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-down"></i><i *ngIf="filterService.filter.sortby !== 'PauseDur'"
                style="color: #bbbbbb" class="fas fa-sort"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
              (click)="sortTable('Stopwords')">{{t('Stopwords')}}
              <i *ngIf="filterService.filter.sortby === 'Stopwords' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-up"></i><i
                *ngIf="filterService.filter.sortby === 'Stopwords' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-down"></i><i *ngIf="filterService.filter.sortby !== 'Stopwords'"
                style="color: #bbbbbb" class="fas fa-sort"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
              (click)="sortTable('Compliance')">{{t('Compliance')}}
              <i *ngIf="filterService.filter.sortby === 'Compliance' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-up"></i><i
                *ngIf="filterService.filter.sortby === 'Compliance' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-down"></i><i *ngIf="filterService.filter.sortby !== 'Compliance'" style="color: #bbbbbb"
                class="fas fa-sort"></i>
            </button>
            <button type="button" class="btn btn-link btn-sm" style="color: #bbbbbb"
              (click)="sortTable('Emotion')">{{t('Emotion')}}
              <i *ngIf="filterService.filter.sortby === 'Emotion' && filterService.filter.sortorder ==='desc'"
                class="fas fa-sort-up"></i><i
                *ngIf="filterService.filter.sortby === 'Emotion' && filterService.filter.sortorder ==='asc'"
                class="fas fa-sort-down"></i><i *ngIf="filterService.filter.sortby !== 'Emotion'" style="color: #bbbbbb"
                class="fas fa-sort"></i>
            </button>
          </div>
          <div>
            <div class="d-flex flex-column w-100">
              <ng-container *ngIf="(filterService.files | async) as files">
                <div class="d-flex flex-row border-top border-bottom align-items-stretch justify-content-start"
                  *ngFor="let item of files; let i = index">
                  <div (click)="markFavorite(item)" style="cursor: pointer; width: 2%;" class="align-self-center">
                    <span *ngIf="filterService.lastFileId === item.filename" #scroll></span>
                    <i *ngIf="getBool(item.pin)" class="fa fa-star"></i>
                    <i *ngIf="!getBool(item.pin)" class="far fa-star"></i>
                  </div>
                  <div style="width: 44%">
                    <div class="d-flex flex-column">
                      <div class="w-100 mt-1">
                        <a [routerLink]="getLink(item)" tooltip="{{item.filename}}">
                          <span class="d-inline-block text-truncate font-weight-bold" style="max-width: 100%;">
                            {{item.filename}}
                          </span>
                        </a>
                      </div>
                      <div class="w-100">
                        <div class="d-flex flex-row justify-content-start">
                          <div class="w-50 align-self-center ">
                            <div class="w-100 my-1">
                              <a style="text-decoration: underline; cursor: pointer;"
                                (click)="filterByBatch(item.batchid)">{{item.batchid}}</a>
                            </div>
                          </div>
                          <div class="pr-4" style="font-size: xx-small;">
                            <div class="mb-1">
                              <span class="mr-2">{{t('Uploaded')}}</span>
                              <span class="float-right font-weight-bold">{{item.uploaddate | date: 'dd/MM/yyyy'}}</span>
                            </div>
                            <div class="mb-1">
                              <span class="mr-2">{{t('Duration')}}</span>
                              <span class="float-right font-weight-bold">{{ getFormatedTime(item.duration)}}</span>
                            </div>
                            <div class="mb-1">
                              <span class="mr-2"> {{t('Silence')}}</span>
                              <span *ngIf="item.pause && item.pause.dur"
                                class="float-right font-weight-bold">{{getFormatedTime(item.pause.dur)}}
                                ({{item.pause.dur / item.duration | percent}})</span>
                            </div>
                          </div>
                          <div style="font-size: xx-small;">
                            <div class="mb-1">
                              <span class="mr-2">{{t('Pauses')}}</span>
                              <span class="float-right font-weight-bold"></span>
                            </div>
                            <div class="mb-1">
                              <span class="mr-2">{{t('Max.')}}</span>
                              <span class="float-right font-weight-bold">-</span>
                            </div>
                            <div class="mb-1">
                              <span class="mr-2">{{t('Avg.')}}</span>
                              <span *ngIf="item.pause && item.pause.avg"
                                class="float-right font-weight-bold">{{getFormatedTime(item.pause.avg)}}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="w-100 mb-1">
                        <span class="badge badge-secondary mr-1" *ngFor="let tag of item.tags">{{tag}}</span>
                        <button class="btn p-0 c-normal" style="cursor: pointer;" (click)="showModal(tagModal, item, i)"
                          tooltip="{{t('Edit tags')}}">
                          <i class="fa fa-pencil-alt"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-column  align-self-center" style="width:15%">
                    <div class="d-flex flex-row justify-content-between align-self-scratch mb-2">
                      <div>
                        <i tooltip="{{t('All')}}" class="fa fa-user-friends mr-2"></i>
                        <span tooltip="{{getStopwords(item)}}"
                          class="badge badge-danger">{{item.stopwordcount ? item.stopwordcount : 0}}</span>
                      </div>
                      <div>
                        <i class="fa fa-headset mr-2" tooltip="{{t('Agent')}}"></i>
                        <span tooltip="{{getAgentStopwords(item)}}"
                          class="badge badge-danger">{{item.agentstopwordcount ? item.agentstopwordcount : 0 }}</span>
                      </div>
                      <div class="mr-4">
                        <i tooltip="{{t('Client')}}" class="fa fa-user-tie mr-2"></i>
                        <span tooltip="{{getCustomerStopword(item)}}"
                          class="badge badge-danger">{{item.customerstopwordcount ? item.customerstopwordcount : 0}}</span>
                      </div>
                    </div>
                    <div class="" *ngIf="item.topic">
                      <i class="fas fa-quote-left mr-1"></i>{{item.topic.topic}}<span
                        class="font-weight-bold ml-1">{{item.topic.confidence}} %</span>
                    </div>
                  </div>
                  <div class="d-flex flex-row justify-content-around align-self-scratch" style="width: 30%">
                    <div class="d-flex justify-content-center align-self-scratch">
                      <div class="d-flex flex-column  p-2">
                        <div style="font-size: x-small;" class="my-2 font-weight-bold">{{t('Compliance')}}:</div>
                        <div class="d-flex flex-row">
                          <div class="align-self-center text-center mr-1">
                            <i class="fa fa-2x fa-shield-alt"></i>
                          </div>
                          <h2 class="m-0"
                            [ngStyle]="{'color': getOpacityLevelCompliance(item.compliancepercent), 'width': '4rem'}">
                            {{item.compliancepercent !== '-' ? abc(item.compliancepercent) + '%' : '-    ' }}
                          </h2>
                        </div>
                      </div>
                    </div>
                    <div class="d-flex justify-content-center align-self-scratch">
                      <div class="d-flex flex-column  p-2">
                        <div style="font-size: x-small;" class="my-2 font-weight-bold">{{t('Sentiment trend')}}:</div>
                        <ng-container *ngIf="hasTrend(item.sentimentTrend); else emptyTrend">
                          <div class="d-flex flex-row align-self-center mt-1">
                            <i class="far fa-2x" [ngClass]='getTrend(item.sentimentTrend.start)'
                              [tooltip]="item.sentimentTrend.start"></i>
                            <i class="fas fa-long-arrow-alt-right fa-2x mx-2"></i>
                            <i [ngClass]='getTrend(item.sentimentTrend.end)' [tooltip]="item.sentimentTrend.end"
                              class="far fa-2x"></i>
                          </div>
                        </ng-container>
                        <ng-template #emptyTrend>
                          <div class="d-flex flex-row align-self-start">
                            <h2 style="width: 4rem">
                              -
                            </h2>
                          </div>
                        </ng-template>
                      </div>
                    </div>
                    <div class="d-flex justify-content-center align-self-scratch"
                      [ngStyle]="{'background': getOpacityLevelAnger(item.angertop)}">
                      <div class="d-flex flex-column p-2">
                        <div style="font-size: x-small;" class="my-2 font-weight-bold">{{t('Average emotional level')}}:
                        </div>
                        <div class="d-flex flex-row">
                          <div class="align-self-center text-center mr-1"><i class="fa fa-2x fa-thermometer-empty"></i>
                          </div>
                          <h2 class="m-0" *ngIf="item.angertop && item.angertop.anger; else empty">
                            {{item.angertop && item.angertop.anger}}%
                          </h2>
                          <ng-template #empty>
                            <h2 style="width: 4rem;">
                              -
                            </h2>
                          </ng-template>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex justify-content-around" style="width: 7%">
                    <button class="btn p-2 c-normal align-self-center" style="cursor: pointer;"
                      (click)="proccessFile(item)" tooltip="{{t('Refresh')}}{{item.proccessing ? '...' : ''}}">
                      <i class="fa fa-sync"></i>
                    </button>
                    <button class="btn p-2 c-normal align-self-center" style="cursor: pointer;"
                      (click)="delete(item.batchid, item.fileid)" tooltip="{{t('Delete')}}">
                      <i class="fa fa-trash-alt"></i>
                    </button>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-around" *ngIf="!filterService.isLoading">
          <div class="btn-toolbar mb-3 mt-3">
            <div class="btn-group mr-2 mb-2">
              <div
                *ngFor="let pageItem of filterService.fileStore | paginate: { itemsPerPage: filterService.filter.itemsn, currentPage: filterService.filter.pagen, totalItems: filterService.totalcount }">
              </div>
              <pagination-controls (pageChange)="getPage($event)" previousLabel="{{t('previous')}}"
                nextLabel="{{t('next')}}"></pagination-controls>
            </div>
          </div>
        </div>
        <h6 *ngIf="!filterService.isLoading">{{t('Total files on page')}} {{filterService.label}} {{t('out of')}}
          {{filterService.totalcount}}</h6>
        <button *ngIf="!filterService.isLoading" class="btn mt-3 btn-secondary" (click)="refresh()">Refresh</button>
      </div>
      <ng-template #loading>
        {{t('Loading...')}}
      </ng-template>
    </div>
  </nb-card-body>
</nb-card>

<ng-template #tagModal>
  <div class="modal-header">
    {{t('Tags')}}
    <button type="button" class="close pull-right" aria-label="Close" (click)="hideModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body tagsModal">
    <tag-input [(ngModel)]="itemTags" [editable]="true" theme="minimal" (onAdd)="onItemAdd($event, 'itemTags')"
      placeholder="{{t('Add Tag')}}" secondaryPlaceholder="{{t('Add Tag')}}" [separatorKeys]="[',']"
      [separatorKeyCodes]="[13]" (onBlur)="onItemAdd($event, 'itemTags')"></tag-input>
    <div class="text-right">
      <button class="btn btn-primary mr-3" (click)="saveTags()">{{t('Save')}}</button>
      <button class="btn btn-link btn-secondary" (click)="hideModal()">{{t('Close')}}</button>
    </div>
  </div>
</ng-template>

<ng-template #spinner>
  <div class="load-container load1">
    <div class="loader">{{ t("Loading...") }}</div>
  </div>
</ng-template>