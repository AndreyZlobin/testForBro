<nb-card>
  <nb-card-body>
    <div>
      <div class="alert alert-danger" *ngIf="errorMessage">
        {{ t("Error:") }} {{ t(errorMessage) }}
      </div>
      <div>
        <div class="d-flex flex-row py-1">
          <button class="btn btm-sm btn-secondary mr-2" style="cursor: pointer;"
            [disabled]=" filterService.hasPrevLink(fileParams.filename, fileParams.batchid)"
            [routerLink]="filterService.getPrevLink(fileParams.filename, fileParams.batchid)">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="btn btm-sm btn-secondary mr-2" style="cursor: pointer;"
            [disabled]="filterService.hasNextLink(fileParams.filename, fileParams.batchid)"
            [routerLink]="filterService.getNextLink(fileParams.filename, fileParams.batchid)">
            <i class="fas fa-chevron-right"></i>
          </button>
          <h2 class="text-truncate my-2" style="max-width: 56vw;">
            {{ fileParams.filename }}
          </h2>
          <button class="btn btm-sm btn-secondary ml-auto" style="cursor: pointer;" routerLink="/user/files">
            {{ t("Back to List") }}
          </button>
        </div>
      </div>
      <nb-tabset (changeTab)="changeTab($event)" *ngIf="currentView">
        <nb-tab tabTitle="Player" [active]="currentView === 'player'">
        </nb-tab>
        <nb-tab tabTitle="Analytics" [active]="currentView === 'analytic'">
        </nb-tab>
      </nb-tabset>
      <div class="d-flex flex-column" *ngIf="currentView === 'player'">
        <ng-container *ngIf="fileParams.filename && fileParams.batchid && fileUrl; else empty">
          <ngx-player [fileName]="fileParams.filename" [batchId]="fileParams.batchid" [fileUrl]="fileUrl"
            (ready)="pushRegions()"></ngx-player>
        </ng-container>
        <div style="overflow-y: auto;">
          <div style="height: 56vh;">
            <ngx-text-log [batchId]="fileParams.batchid" [fileName]="fileParams.filename"></ngx-text-log>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="currentView === 'analytic'">
        <div class="col-12 mb-3" *ngIf="sttfulltext">
          <div class="card">
            <div class="card-header">{{t('Text')}}</div>
            <div class="card-body">
              <div class="mt-2">
                <ngx-full-text [batchId]="fileParams.batchid" [fileName]="fileParams.filename"></ngx-full-text>
              </div>
            </div>
          </div>
        </div>
        <div class="col-6 mb-3" *ngIf="keywords">
          <div class="card">
            <div class="card-header">{{t('Stopwords')}}</div>
            <div class="card-body p-0">
              <ngx-text-stopwords [batchId]="fileParams.batchid" [fileName]="fileParams.filename"></ngx-text-stopwords>
            </div>
          </div>
        </div>
        <div class="col-6 mb-3" *ngIf="misswordsNotFound.length || misswords.length">

        </div>
        <div class="col-6 mb-3">
          <div class="card">
            <div class="card-header">{{t('Sankey Diagram')}}</div>
            <div class="card-body">
              <div echarts [options]="sankey"></div>
            </div>
          </div>
        </div>
        <div class="col-6 mb-3">
          <div class="card">
            <div class="card-header">{{t('Keywords and phases')}}</div>
            <div class="card-body">
              <div echarts [options]="treeRadialData">
              </div>
            </div>
          </div>
        </div>
        <div class="col-6 mb-3" *ngIf="popularWords">
          <div class="card">
            <div class="card-header">{{t('Most frequency used words')}}</div>
            <div class="card-body p-0">
              <angular-tag-cloud [data]="popularWords" [zoomOnHover]="zoomOptions" [overflow]="false">
              </angular-tag-cloud>
            </div>
          </div>
        </div>
        <div class="col-6 mb-3" *ngIf="popularWords">
          <div class="card">
            <div class="card-header">{{t('Hits vs words')}}</div>
            <div class="card-body">
              <ul class="list-group list-group-flush" style="height: 300px; overflow-y: auto">
                <li class="list-group-item d-flex" *ngFor="let popularWord of popularWords" style="color: #211b19">
                  <span>{{popularWord.text}}</span>
                  <span class="ml-auto">{{popularWord.weight}}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <ng-template #loading>
        {{ t("Loading...") }}
      </ng-template>
    </div>
  </nb-card-body>
</nb-card>